{% extends "base.html" %}
{% load static %}

{% block content %}
<main class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Указание продукта -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">{{ product.category.title }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
                </ol>
            </nav>

            <div class="row g-4">
                <!-- Отдельный продукт -->
                {% include 'shop/_product_detail/detail.html' %}

                <!-- Отзывы -->
                {% include 'shop/_product_detail/reviews.html' %}

                <!-- Похожие товары -->
                {% include 'shop/_product_detail/related_product.html' %}

            </div>
        </div>
    </div>
</main>

<!-- Подключение JS Lightbox -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>

<script>
    $(document).on('click', '#add-button', function(e){
        e.preventDefault();
        const $button = $(this);
        const productId = $('#add-button').val();
        const productQty = $('#select option:selected').val();
        $.ajax({
            type: 'POST',
            url: '{% url "cart:add-to-cart" %}',
            data: {
                product_id: productId,
                product_qty: productQty,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success: function(response){
                // Обновляем счетчик корзины
                $('#lblCartCount').text(response.qty);

                // Изменяем кнопку
                $button.prop('disabled', true)
                      .removeClass('btn-primary')
                      .addClass('btn-vibrant-success')
                      .html('<i class="bi bi-check-circle me-2"></i> В корзине');

                // Можно добавить анимацию
                $button.css('transform', 'scale(1.05)');
                setTimeout(() => $button.css('transform', 'scale(1)'), 200);
            },
            error: function(error){
                console.log(error);
                alert('Произошла ошибка при добавлении в корзину');
            }
        });
    });
        lightbox.option({
        'resizeDuration': 300,          // Анимация масштабирования (мс)
        'fadeDuration': 300,            // Анимация появления/исчезания
        'wrapAround': true,             // Бесконечная навигация
        'showImageNumberLabel': false,  // Скрыть "1/10"
        'positionFromTop': 100,        // Отступ сверху (px)
        'disableScrolling': true,      // Блокировка скролла страницы
        'fitImagesInViewport': true,   // Подгонка под размер экрана
        'maxWidth': 1200,              // Макс. ширина изображения
        'maxHeight': 1000              // Макс. высота изображения
    });
</script>

<style>
    .btn-vibrant-success {
        background-color: #00ff00ff !important;
        border-color:   #00ff00ff !important;
        color: white !important;
    }
    .btn-vibrant-success:hover {
        background-color: #0bf00bc6 !important;
        border-color: #00ff00d6 !important;
    }
    .product-image-container {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
    }
    
    .product-thumb-container {
        background-color: #f8f9fa;
        border-radius: 0.25rem 0.25rem 0 0;
    }
</style>
{% endblock %}